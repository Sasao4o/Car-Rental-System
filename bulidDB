DROP DATABASE carrentalsystem;
CREATE DATABASE carrentalsystem;
use carrentalsystem;
CREATE TABLE country(
 countryid INT NOT NULL AUTO_INCREMENT PRIMARY KEY ,
 countryname VARCHAR(40) NOT NULL,
 UNIQUE (countryname)
);
CREATE TABLE city(
 cid INT NOT NULL  AUTO_INCREMENT PRIMARY KEY,
 cname VARCHAR(40) NOT NULL,
 countryid INT NOT NULL ,
 FOREIGN KEY(countryid) REFERENCES country(countryid)

);

CREATE TABLE person(
    pid INT NOT NULL AUTO_INCREMENT PRIMARY KEY ,
    fname VARCHAR(40) NOT NULL,
    mname VARCHAR(40),
    lname VARCHAR(40) NOT NULL,
    email VARCHAR(225) UNIQUE,
    gender ENUM('male', 'female'),
    role ENUM('SuperAdmin', 'Admin', 'user'),
    cid INT,
    mobileno VARCHAR(15),
    PASSWORD VARCHAR(255),
    BankNo VARCHAR(15),
    FOREIGN KEY(cid) REFERENCES city(cid)
); 

CREATE TABLE employee(
    eid INT NOT NULL PRIMARY KEY AUTO_INCREMENT,
    salary FLOAT NOT NULL,
    enrolled_date TIMESTAMP,
    POSITION VARCHAR(30),
    In_Work enum('Full Load','Free'),	
    pid INT NOT NULL UNIQUE,
    FOREIGN KEY(pid) REFERENCES person(pid)
); CREATE TABLE demander(
    Did INT NOT NULL PRIMARY KEY AUTO_INCREMENT,
    pid INT NOT NULL UNIQUE,
    FOREIGN KEY(pid) REFERENCES person(pid)
); CREATE TABLE supplier(
    sid INT NOT NULL AUTO_INCREMENT,
    car_count INT,
    pid INT NOT NULL UNIQUE,
    FOREIGN KEY(pid) REFERENCES person(pid),
    PRIMARY KEY(sid)
); CREATE TABLE payment(
    pay_id INT NOT NULL PRIMARY KEY AUTO_INCREMENT,
    amount INT NOT NULL,
    pid INT NOT NULL,
    FOREIGN KEY(pid) REFERENCES person(pid)
);CREATE TABLE warehouse(
    warehouse_id INT NOT NULL PRIMARY KEY AUTO_INCREMENT,
    Aval_capacity INT NOT NULL,
    location VARCHAR(225),
    city_id INT NOT NULL,
    FOREIGN KEY(city_id) REFERENCES city(cid)
); CREATE TABLE car(
    car_id INT NOT NULL AUTO_INCREMENT PRIMARY KEY ,
    NAME VARCHAR(225) NOT NULL,
    model VARCHAR(6),
    plate_no VARCHAR(10),
    Status enum ('reserved','rented','active','broken'),
        cond VARCHAR(220),
        warehouse_id INT NOT NULL,
        FOREIGN KEY(warehouse_id) REFERENCES warehouse(warehouse_id)
);
CREATE TABLE contract(
    contra_id INT NOT NULL AUTO_INCREMENT PRIMARY KEY,
    sid INT NOT NULL,
    car_id INT NOT NULL,
    cost FLOAT,
    status enum ('Rejected','Accepted','Pending'),
    start_date DATE,
    end_date DATE,
    FOREIGN KEY(car_id) REFERENCES Car(car_id),
    FOREIGN KEY(sid) REFERENCES supplier(sid)
);CREATE TABLE employee_pay_cont(
    eid INT NOT NULL,
    pid INT NOT NULL,
    contra_id INT NOT NULL,
    PRIMARY KEY(eid, pid, contra_id),
    FOREIGN KEY(eid) REFERENCES employee(eid),
    FOREIGN KEY(pid) REFERENCES payment(pay_id),
    FOREIGN KEY(contra_id) REFERENCES contract(contra_id)
); CREATE TABLE reservation(
    reserve_id INT NOT NULL AUTO_INCREMENT,
    Did INT NOT NULL,
    startDate DATE NOT NULL,
    EndDate DATE NOT NULL,
    car_id INT NOT NULL,
    Eid INT NOT NULL,
    PRIMARY KEY(reserve_id),
    FOREIGN KEY(car_id) REFERENCES Car(car_id),
    FOREIGN KEY(Eid) REFERENCES Employee(eid)
);CREATE TABLE demander_pay(
    Did INT NOT NULL,
    reserve_id INT NOT NULL,
    pid INT NOT NULL,
    eid INT NOT NULL,
    PRIMARY KEY(eid, pid),
    FOREIGN KEY(eid) REFERENCES employee(eid),
    FOREIGN KEY(pid) REFERENCES payment(pay_id),
    FOREIGN KEY(reserve_id) REFERENCES reservation(reserve_id)
);
